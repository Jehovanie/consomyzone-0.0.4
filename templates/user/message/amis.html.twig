{% extends 'base.html.twig' %}

{% block title %}ConsoMyZone
{% endblock %}

{% block stylesheets %}
	<link rel="stylesheet" href="{{asset('assets/css/account/account.css')}}">
	<link rel="stylesheet" href="{{asset('assets/css/message/message.css')}}">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">
{% endblock %}

{% block javascripts %}
	<script src="{{ asset('assets/js/account/account.js') }}" defer></script>
	<script src="{{ asset('assets/js/account/account_mobile.js') }}" defer></script>
	<script src="{{ asset('assets/js/message/message.js') }}" defer></script>
	<script src="{{ asset('assets/js/message/eventStrem_message.js') }}" defer></script>
{% endblock %}

{% block body %}

	<main>
		<div class="content_left_menu_account fixed-top mt-5 col responsif-none">
			<div class="left_menu">
				{% include "shard/account_navleft.html.twig" %}
			</div>
		</div>

		<div class="content_left_menu_account_mobile fixed-top mt-5 col responsif-none-mobile">
			<div class="left_menu">
				{% include "shard/account_navleft_mobile.html.twig" %}
			</div>
		</div>

		<div class="navbar-mobile">
			<div class="fixed-top col responsif-none">
				{{ include('shard/account_navbar.html.twig') }}
			</div>

			<div class="fixed-top col responsif-none-mobile">
				{{ include('shard/account_navbar_mobile.html.twig') }}
			</div>
		</div>

		<div class="content_block_message responsif-none">
			<div style="display:flex;width:100%;height:100%;">
				<div class="left-message">
					<section class="chats" data-myid="{{app.user.id}}" data-toggle-current-profil={{(profil[0].getPhotoProfil is same as (null)) ? "null" : profil[0].getPhotoProfil }} data-toggle-other-profil={{(userToProfil.photo_profile is same as (null)) ? "null" : userToProfil.photo_profile }}>
						<div class="header-chat" data-toggle-id-user-to={{userToProfil.id}}>

							<div class="d-flex flex-row bd-highlight mb-3">
								<div class="p-2 bd-highlight">
									<img
									class="img_pdp" src={{ (userToProfil.photo_profile != null) ? userToProfil.photo_profile : asset('uploads/users/photos/img_avatar.png') }} alt="{{ userToProfil.firstname }}">
								{# <img class="img_pdp" src="https://images.unsplash.com/photo-1438761681033-6461ffad8d80?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=1050&q=80" alt="{{ userToProfil.firstname }}" > #}
								</div>
								<div class="p-2 bd-highlight">
									<a href="/user/profil/{{userToProfil.id}}" style="text-decoration:none;">
										<h6>
											{{ userToProfil.firstname  ~ " " ~  userToProfil.lastname }}</h6>
									</a>
									<p class="email_user">
										{{userToProfil.email }}
									</p>
								</div>
							</div>

						</div>

						<div class="messages-chat mode_pc">
							{% if userToProfil.message|length > 0  %}

								{% set iter = 0 %}
								{% set margin_bott = "" %}

								{% for msg in userToProfil.message %}

									{% if iter == userToProfil.message|length - 1 %}

										{% set margin_bott = "margin-bottom: 60px !important;" %}

									{% endif %}

									{% if msg.isForMe == "1" %}

										<div class="message" style={{margin_bott}} id={{"message_" ~ msg.id}}>
											<div class="photo" style="background-image: url({{ (userToProfil.photo_profile != null) ? userToProfil.photo_profile   : asset('public/uploads/users/photos/img_avatar.png') }} ">
												<div class="online"></div>
											</div>
											<div>
												{% if msg.content is defined and msg.content.text is defined %}
													{% if msg.content.text %}
														<p class="text">{{msg.content.text}}</p>
													{% endif %}
													{# <p class="text">{{msg.content ? msg.content.text : "" }}</p> #}
												{% endif %}

												{% if msg.content.images is defined and msg.content.images|length > 0  %}
													<div class="img_slide_left">
														{% for image in msg.content.images %}
															<img class="img_msg" src="{{asset('uploads/messages/'~ image )}}" alt="Message image">
														{% endfor %}
													</div>
												{% endif %}
											</div>

										</div>
										<p class="time">
											{{msg.datetime}}</p>

									{% else %}
										<div class="message" style={{margin_bott}} id={{"message_" ~ msg.id}}>
											<div class="response">
												{% if msg.content is defined and msg.content.text is defined %}
													{% if msg.content.text %}
														<p class="text">{{msg.content.text}}</p>
													{% endif %}
													{# <p class="text">{{msg.content ? msg.content.text : "" }}</p> #}
												{% endif %}

												{% if msg.content.images is defined and msg.content.images|length > 0  %}
													<div class="img_slide_right">
														{% for image in msg.content.images %}
															<img class="img_msg" src="{{asset('uploads/messages/'~ image )}}" alt="Message image">
														{% endfor %}
													</div>
												{% endif %}
												<p class="time-right">
													{{msg.datetime}}</p>
											</div>

										</div>

									{% endif %}

									{% set iter = iter + 1 %}

								{% endfor %}
							{% else %}
								<p class="text-center">
									Envoyer lui Hello!!!</p>
							{% endif %}
						</div>

						<div class="content_input_message content_input_message_js_jheo mode_pc" data-toggle-userfrom-id={{app.user.id}} data-toggle-userto-id={{userToProfil.id}}>

							<div
								class="input_message">

								{# record for voice... #}
								<i class="ms-2 fa-solid fa-microphone outer_icon_micro"></i>

								{# input file image #}
								<i class="fa-solid fa-file-import fa-xl ms-3 i_input_file outer_icon_message">
									<input type="file" class="first-input" multiple aria-disabled>
								</i>

								{# if the user put many image #}
								<div class="globla_message">
									<div class="content_image_input content_image_input_js_jheo">
										<i class="fa-solid fa-file-import fa-xl ms-3 i_input_file_under_image"></i>
									</div>
									<textarea rows="1" type="text" placeholder="Votre message" name="message" class="input_message_js_jheo"></textarea>
								</div>

								{# to send message  #}
								<i class="fa-solid fa-paper-plane outer_icon_message btn_send_message_js_jheo"></i>

							</div>
						</div>

					</section>
				</div>
				<div class="right-friend">
					<section class="discussions">
						<div class="discussion search">
							<div class="searchbar">
								<i class="fa fa-search" aria-hidden="true"></i>
								<input type="text" placeholder="Rechercher..." id="search_friend_input"></input>
						</div>
					</div>
					<div class="list_users">

						{% set is_active = 0 %}
						{% for amis in amisTributG %}
							{# don't show current user connected #}
							{% if not (amis.id|number_format is same as(app.user.id|number_format)) %}

								<div class="discussion {{is_active == 0 ? " message-active" : "" }}">
									<div class="photo me-1" style="background-image: url({{ ( amis.photo != null) ? amis.photo : asset('uploads/users/photos/img_avatar.png')}});">
										<div class="online"></div>
									</div>
									<div class="desc-contact">
										<a href="{{path('app_message') ~ '?user_id=' ~ amis.id }}" data-toggle-user-id={{amis.id}} tooltip={{amis.email}} class="list_amis_to_chat">
											{{amis.firstname ~ " " ~ amis.lastname }}</a>
										<p class="email_user">{{ amis.email }}</p>
									</div>
									{# <div class="timer">12 sec</div> #}
								</div>


							{% endif %}
							{% set is_active = is_active + 1 %}

						{% endfor %}
					</div>

				</section>
			</div>
		</div>

	</div>
</div>
{{include('user/message/amis_mobile.html.twig')}}</main>

<div id="fullpage" onclick="this.style.display='none';"></div>
{% endblock %}
